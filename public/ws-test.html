<!doctype html>
<html lang="en">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Binance WS Test</title>
<style>
  body{font:14px/1.45 system-ui;margin:24px}
  pre{white-space:pre-wrap;word-break:break-word;border:1px solid #ddd;padding:12px;border-radius:8px;max-height:60vh;overflow:auto}
</style>

<h1>WS Test (Binance Spot)</h1>
<p>Status: <b id="st">init</b></p>
<pre id="log"></pre>

<script>
  const st = document.getElementById('st');
  const log = document.getElementById('log');

  // Default: Spot trades for BTCUSDT. (Change symbol if you want.)
  const url = 'wss://stream.binance.com:9443/ws/btcusdt@trade';
  let ws, tries = 0;

  function write(...a){
    log.textContent += a.join(' ') + '\n';
    log.scrollTop = log.scrollHeight;
  }

  function connect(){
    st.textContent = 'connectingâ€¦';
    ws = new WebSocket(url);

    ws.onopen = () => {
      st.textContent = 'open';
      tries = 0;
      write('WS open:', url);
    };

    ws.onmessage = (ev) => {
      try {
        const m = JSON.parse(ev.data);
        // Common fields for @trade stream: s (symbol), p (price), E (event time)
        write('msg', m.s || '', m.p || '', m.E || '');
      } catch {
        write('raw', ev.data);
      }
    };

    ws.onerror = (e) => write('error', (e && e.message) || 'unknown');

    ws.onclose = (e) => {
      st.textContent = `closed (${e.code})`;
      const delay = Math.min(30000, 1000 * Math.pow(2, Math.min(++tries, 5)));
      write('closed, retry in', delay + 'ms');
      setTimeout(connect, delay);
    };
  }

  connect();

  // If you ever want FUTURES instead, replace the url with:
  // const url = 'wss://fstream.binance.com/ws/btcusdt@markPrice';
</script>
</html>
